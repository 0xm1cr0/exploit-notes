---
title: MQTT Pentesting
description: MQTT is a publish-subscribeb network protocol for the Internet of Things (IoT). Default ports are 1883, 8883 (TLS).
tags:
    - IoT
refs:
date: 2022-12-22
draft: false
---

## Enumeration

```sh
nmap --script mqtt-subscribe -p 1883 <target-ip>
```

<br />

## Interaction

**[mosquitto](https://github.com/eclipse/mosquitto)** is a MQTT utilities that include a broker and publish/subscribe clients.  
We use the mosquitto to interact with MQTT.

If you don’t have mosquitto in Linux, install packages.

```sh
sudo apt install -y mosquitto mosquitto-clients
```

### Subscribe to a Topic

```sh
# Local
# -t: Topic, -p: Port
mosquitto_sub -t sensors/temperature
mosquitto_sub -p 1883 -t sensors/temperature
# specify username/password
mosquitto_sub -u username -P password -t sensors/temperature
# -d: Enable debug message
mosquitto_sub -t sensors/temperature -d

# Remote
mosquitto_sub -h example.com -t kitchen/sensor/thermostat
```

To get the mosquitto’s version, run the following.

```bash
mosquitto_sub -t '$SYS/broker/version'
mosquitto_sub -h example.com -t '$SYS/broker/version'
```

### Publish to a Topic

```sh
# Local
# -t: Topic, -p: Port, -m: Message
mosquitto_pub -t sensors/temperature -m "test message"
mosquitto_pub -p 1883 -t sensors/temperature -m "test message"
# specify username/password
mosquitto_pub -u username -P password -t sensors/temperature -m "test message"
# -d: Enable debug message
mosquitto_pub -t sensors/temperature -m "test message" -d

# Remote
mosquitto_pub -h example.com -t kitchen/sensor/thermostat -m "test message"
```