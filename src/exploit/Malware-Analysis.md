---
title: Malware Analysis
description: 
tags:
    - Malware
draft: false
---

## Analysis

1. **Online Tools**

    - **[Online Malware Analysis Sandbox](https://app.any.run/)**

        Cloud-based malware analysis service.

    - **[VirusTotal](https://www.virustotal.com/gui/home/upload)**

         Analyse suspicious files, domains, IPs and URLs to detect malware and other breaches, automatically share them with the security community.

2. **Softwares**

    - **[Process Hacker](https://processhacker.sourceforge.io/)**

        It monitors system resources, debug software and detect malware.

3. **Programs**

    - **[Yara](https://github.com/virustotal/yara)**

        The pattern matching swiss knife for malware researchers.

        1. **Automation Tools**

            - **[Loki](https://github.com/Neo23x0/Loki)**

                ```sh
                # Update first, then will add `signature-base` directory
                python ~/Loki/loki.py --update

                # Run
                python ~/Loki/loki.py -p ./suspicious_files_dir

                # Run & output a log file
                python loki.py -p ./suspicious_files_dir -l log.txt
                ```

            - **[yarGen](https://github.com/Neo23x0/yarGen)**

                 ```sh
                # Update first
                python ~/yarGen/yarGen.py --update

                # Generate Yara ruls for specific file
                python ~/yarGen/yarGen.py -m ./suspicious_files_dir --excludegood -o ./suspicious_files_dir/rule.yar

                # Check if the file flagged
                yara ./suspicious_files_dir/rule.yar ./suspicious_files_dir/somefile.php

                # If flagged, copy this ruls to Loki's signature yara directory
                cp ./suspicious_files_dir/rule.yar ~/Loki/signature-base/yara

                # Then run Loki
                # ...
                ```

        2. **Manual**

            - **Find Files Matches Rules**

                ```sh
                yara rule.yar ./somedir
                # Print only number of matches
                yara -c rule.yar ./somedir
                # Print only not satisfied rules 
                yara -n rule.yar ./somedir
                # Print metadata
                yara -m rule.yar ./somedir
                ```

            - **Create Rules**

                Create "rule.yar".

                ```txt
                rule rule_name {
                    meta:
                        author = "pentester"
                        description = "test rule"
                        created = "6/20/2022 00:00"
                    strings:
                        $hello = "Hello"
                        $text_file = ".txt"
                    condition:
                        $hello and $text_file
                }
                ```       

<br />

## Attack with Malware

1. **Programs**

    - **[Reptile](https://github.com/f0rb1dd3n/Reptile)**

        LKM Linux rootkit.
